"use strict";var a=require("kitsu"),t=require("https"),e=require("url"),s=require("lodash.get");function i(a){return a&&"object"==typeof a&&"default"in a?a:{default:a}}var n=i(a),o=i(t),c=i(e),l=i(s),u={kitsu:null,baseURL:"",languages:[],getAll:async(a,t={},e=null)=>{if(!u.kitsu)throw"API has not been initialized. call init()";const s=async(a=[],t,e={})=>{const{data:i,links:n}=await u.kitsu.get(t,e),o=l.default(n,"next.href");if(a=a.concat(i),o){const i=c.default.parse(o,!0),n=i.query["page[offset]"],l=i.query["page[limit]"];return e.page={offset:n,limit:l},s(a,t,e)}return a};let i=null;const n=u.kitsu.axios.defaults.baseURL;return e?(u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/"),i=await s([],a,t)):i=await Promise.all(u.languages.map(async e=>(u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/"),await s([],a,t)))),u.kitsu.axios.defaults.baseURL=n,i},get:async(a,t={},e=null)=>{if(!u.kitsu)throw"API has not been initialized. call init()";let s=null;const i=u.kitsu.axios.defaults.baseURL;if(e){u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/");const{data:i}=await u.kitsu.get(a,t);s=i}else s=await Promise.all(u.languages.map(async e=>{u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/");const{data:s}=await u.kitsu.get(a,t);return s}));return u.kitsu.axios.defaults.baseURL=i,s},getResponse:async(a,t={},e=null)=>{if(!u.kitsu)throw"API has not been initialized. call init()";let s=null;const i=u.kitsu.axios.defaults.baseURL;return e?(u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/"),s=await u.kitsu.get(a,t)):s=await Promise.all(u.languages.map(async e=>{u.kitsu.axios.defaults.baseURL="".concat(u.baseURL).concat(e,"/api/");return await u.kitsu.get(a,t)})),u.kitsu.axios.defaults.baseURL=i,s},getRest:async(a,t={},e=null)=>{if(!u.kitsu)throw"API has not been initialized. call init()";return"boolean"==typeof e?await u.kitsu.axios.get("".concat(u.baseURL).concat(a),t):"string"==typeof e?await u.kitsu.axios.get("".concat(u.baseURL).concat(e,"/").concat(a),t):await Promise.all(u.languages.map(async e=>({locale:e,response:await u.kitsu.axios.get("".concat(u.baseURL).concat(e,"/").concat(a),t)})))},postRest:async(a,t={},e=null,s={})=>{if(!u.kitsu)throw"API has not been initialized. call init()";return"boolean"==typeof e?u.kitsu.axios.post("".concat(u.baseURL).concat(a),t,s):"string"==typeof e?u.kitsu.axios.post("".concat(u.baseURL).concat(e,"/").concat(a),t,s):Promise.all(u.languages.map(async e=>({locale:e,response:u.kitsu.axios.post("".concat(u.baseURL).concat(e,"/").concat(a),t,s)})))},init:(a,t={},e=[])=>{u.initialized=!0,u.baseURL=a,u.languages=e,u.kitsu=new n.default({baseURL:a,camelCaseTypes:!1,resourceCase:"none",pluralize:!1,axiosOptions:{httpsAgent:new o.default.Agent({rejectUnauthorized:!1}),headers:t},headers:t})},enableDebug:()=>{u.kitsu.axios.interceptors.request.use(a=>(console.log(a),a),a=>Promise.reject(a))}};module.exports=u;
