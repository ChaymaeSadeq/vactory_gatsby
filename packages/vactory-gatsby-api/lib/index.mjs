const t=require("kitsu"),a=require("https"),e=require("lodash.get");var i={kitsu:null,baseURL:"",languages:[],getAll:async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!i.kitsu)throw"API has not been initialized. call init()";const s=async function t(){let a=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],s=arguments.length>1?arguments[1]:void 0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const{data:o,links:l}=await i.kitsu.get(s,n),u=e(l,"next.href");if(a=a.concat(o),u){const e=url.parse(u,!0),i=e.query["page[offset]"],o=e.query["page[limit]"];return n.page={offset:i,limit:o},t(a,s,n)}return a},n=i.kitsu.axios.defaults.baseURL,o=await Promise.all(i.languages.map(async e=>(i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(e,"/api/"),await s([],t,a))));return i.kitsu.axios.defaults.baseURL=n,o},get:async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!i.kitsu)throw"API has not been initialized. call init()";let s=null;const n=i.kitsu.axios.defaults.baseURL;if(e){i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(e,"/api/");const{data:n}=await i.kitsu.get(t,a);s=n}else s=await Promise.all(i.languages.map(async e=>{i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(e,"/api/");const{data:s}=await i.kitsu.get(t,a);return s}));return i.kitsu.axios.defaults.baseURL=n,s},getRest:async function(t){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},e=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if(!i.kitsu)throw"API has not been initialized. call init()";return"boolean"==typeof e?await i.kitsu.axios.get("".concat(i.baseURL).concat(t),a):"string"==typeof e?await i.kitsu.axios.get("".concat(i.baseURL).concat(e,"/").concat(t),a):await Promise.all(i.languages.map(async e=>await i.kitsu.axios.get("".concat(i.baseURL).concat(e,"/").concat(t),a)))},init:function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[];i.initialized=!0,i.baseURL=e,i.languages=n,i.kitsu=new t({baseURL:e,camelCaseTypes:!1,resourceCase:"none",pluralize:!1,axiosOptions:{httpsAgent:new a.Agent({rejectUnauthorized:!1}),headers:s},headers:s})},enableDebug:()=>{i.kitsu.axios.interceptors.request.use(t=>(console.log(t),t),t=>Promise.reject(t))}};export default i;
