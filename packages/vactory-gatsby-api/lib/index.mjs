const a=require("kitsu"),t=require("https"),s=require("lodash.get"),e=require("url");var i={kitsu:null,baseURL:"",languages:[],getAll:async(a,t={},n=null)=>{if(!i.kitsu)throw"API has not been initialized. call init()";const o=async(a=[],t,n={})=>{const{data:c,links:l}=await i.kitsu.get(t,n),u=s(l,"next.href");if(a=a.concat(c),u){const s=e.parse(u,!0),i=s.query["page[offset]"],c=s.query["page[limit]"];return n.page={offset:i,limit:c},o(a,t,n)}return a};let c=null;const l=i.kitsu.axios.defaults.baseURL;return n?(i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(n,"/api/"),c=await o([],a,t)):c=await Promise.all(i.languages.map(async s=>(i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(s,"/api/"),await o([],a,t)))),i.kitsu.axios.defaults.baseURL=l,c},get:async(a,t={},s=null)=>{if(!i.kitsu)throw"API has not been initialized. call init()";let e=null;const n=i.kitsu.axios.defaults.baseURL;if(s){i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(s,"/api/");const{data:n}=await i.kitsu.get(a,t);e=n}else e=await Promise.all(i.languages.map(async s=>{i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(s,"/api/");const{data:e}=await i.kitsu.get(a,t);return e}));return i.kitsu.axios.defaults.baseURL=n,e},getResponse:async(a,t={},s=null)=>{if(!i.kitsu)throw"API has not been initialized. call init()";let e=null;const n=i.kitsu.axios.defaults.baseURL;return s?(i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(s,"/api/"),e=await i.kitsu.get(a,t)):e=await Promise.all(i.languages.map(async s=>(i.kitsu.axios.defaults.baseURL="".concat(i.baseURL).concat(s,"/api/"),await i.kitsu.get(a,t)))),i.kitsu.axios.defaults.baseURL=n,e},getRest:async(a,t={},s=null)=>{if(!i.kitsu)throw"API has not been initialized. call init()";return"boolean"==typeof s?await i.kitsu.axios.get("".concat(i.baseURL).concat(a),t):"string"==typeof s?await i.kitsu.axios.get("".concat(i.baseURL).concat(s,"/").concat(a),t):await Promise.all(i.languages.map(async s=>({locale:s,response:await i.kitsu.axios.get("".concat(i.baseURL).concat(s,"/").concat(a),t)})))},postRest:async(a,t={},s=null,e={})=>{if(!i.kitsu)throw"API has not been initialized. call init()";return"boolean"==typeof s?i.kitsu.axios.post("".concat(i.baseURL).concat(a),t,e):"string"==typeof s?i.kitsu.axios.post("".concat(i.baseURL).concat(s,"/").concat(a),t,e):Promise.all(i.languages.map(async s=>({locale:s,response:i.kitsu.axios.post("".concat(i.baseURL).concat(s,"/").concat(a),t,e)})))},init:(s,e={},n=[])=>{i.initialized=!0,i.baseURL=s,i.languages=n,i.kitsu=new a({baseURL:s,camelCaseTypes:!1,resourceCase:"none",pluralize:!1,axiosOptions:{httpsAgent:new t.Agent({rejectUnauthorized:!1}),headers:e},headers:e})},enableDebug:()=>{i.kitsu.axios.interceptors.request.use(a=>(console.log(a),a),a=>Promise.reject(a))}};export default i;
